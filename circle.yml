machine:
  services:
    - docker

dependencies:
  pre:
    - git describe --tags |tee VERSION
    - gpg --yes --batch --import build/private.key
  override:
    - make artifacts DOCKER=true
    - if [ -n "$PASSPHRASE" ]; then for i in ${CIRCLE_ARTIFACTS}/*; do gpg --detach-sig --no-use-agent --yes --batch --passphrase=$PASSPHRASE -u mesos-dns --sign --armor $i; done; fi

test:
  override:
    - make test DOCKER=true
